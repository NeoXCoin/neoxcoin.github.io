<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NeoX Metaverse â€“ Ultra-Mini Test</title>
<link rel="icon" href="https://neoxcoin.github.io/XNXC.png"/>
<style>
  :root{ --neo:#00d9ff }
  html,body{margin:0;min-height:100%;background:linear-gradient(135deg,#0a0a2a,#1f005c);color:#fff;
            font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"PingFang TC","Noto Sans",Arial,sans-serif}
  .logo{position:fixed;z-index:3;top:14px;left:14px;width:48px;opacity:.9}
  .stage{max-width:920px;margin:80px auto 36px;padding:0 16px}
  .card{position:relative;border-radius:14px;overflow:hidden;box-shadow:0 8px 28px rgba(0,0,0,.55);background:#000}
  video,iframe{width:100%;height:58vw;max-height:560px;border:0;display:block}
  .mask{position:absolute;inset:0;background:linear-gradient(to top,rgba(0,0,0,.6),rgba(0,0,0,.12));pointer-events:none}
  .hint{position:absolute;left:50%;bottom:14px;transform:translateX(-50%);font-size:13px;color:var(--neo);
        padding:6px 12px;background:rgba(0,0,0,.34);border:1px solid rgba(0,217,255,.35);border-radius:999px;
        animation:float 2s infinite;opacity:.92;transition:opacity .5s ease}
  @keyframes float{0%,100%{transform:translate(-50%,0)}50%{transform:translate(-50%,-6px)}}
  /* æ¥µå°çš„å³ä¸Šè§’é¢æ¿å‘¼å‡ºéˆ•ï¼ˆ3ç§’è‡ªå‹•éš±è—ï¼‰ */
  .fab{position:fixed;z-index:4;top:12px;right:12px;background:rgba(0,0,0,.55);border:1px solid rgba(255,255,255,.18);
       border-radius:10px;color:#ddd;font-size:12px;padding:6px 9px;cursor:pointer;opacity:.9;transition:opacity .4s}
  .fab.hide{opacity:0;pointer-events:none}
  .panel{position:fixed;z-index:5;top:44px;right:12px;background:#0b0b12;border:1px solid rgba(0,217,255,.25);
         border-radius:12px;box-shadow:0 12px 32px rgba(0,0,0,.45);padding:10px 12px;display:none}
  .panel button{display:block;width:100%;margin:6px 0;padding:8px 10px;border-radius:10px;border:1px solid rgba(0,217,255,.35);
                background:#0f1d22;color:#dff;cursor:pointer;font-size:13px}
  .toast{position:fixed;z-index:6;left:50%;top:14px;transform:translateX(-50%);background:rgba(0,0,0,.65);
         color:#dff;padding:8px 12px;border-radius:10px;border:1px solid rgba(0,217,255,.35);display:none;font-size:13px}
  /* è¡Œå‹•è£ç½®ï¼šç›¡é‡æ¸…çˆ½ï¼Œæç¤ºå¿«é–ƒ */
  @media (max-width:640px){
    .stage{margin:64px auto 18px}
    .hint{font-size:12px}
    .fab{font-size:11px;padding:5px 8px}
  }
</style>
</head>
<body>

<a href="index.html"><img class="logo" src="https://neoxcoin.github.io/XNXC.png" alt="NeoX"/></a>

<div class="stage">
  <div id="mount" class="card" role="button" aria-label="Enter NeoX Metaverse"></div>
</div>

<div id="fab" class="fab">â‹®</div>
<div id="panel" class="panel" role="dialog" aria-label="Mode Panel">
  <button id="openNew">ğŸš€ æ–°åˆ†é é–‹å•Ÿ OnCyber</button>
  <button id="toEmbed">ğŸ§ª åˆ‡æ› Embed æ¨¡å¼ï¼ˆæ¡Œé¢ï¼‰</button>
  <button id="toExternal">âœ… åˆ‡æ› External æ¨¡å¼ï¼ˆé è¨­ï¼‰</button>
</div>

<div id="toast" class="toast"></div>

<script>
(function(){
  // ===== Config =====
  const slug = 'neoxdynamic';
  const oncyber = `https://oncyber.io/${slug}`;
  const bust = 'v='+new Date().toISOString().slice(0,10).replace(/-/g,'');
  const videoSrc = 'https://neoxcoin.github.io/NeoXDynamicVisions%20.mp4';
  const poster   = 'https://neoxcoin.github.io/XNXC.png';
  const isMobile = /iPhone|Android|iPad/i.test(navigator.userAgent);

  const key='neox_mode';
  const qsMode = new URLSearchParams(location.search).get('mode');
  let mode = (qsMode==='embed'||qsMode==='external')?qsMode:(localStorage.getItem(key)||'external');
  if(isMobile) mode='external'; // æ‰‹æ©Ÿä¸€å¾‹å¤–é–‹ä»¥æœ€æ¸…çˆ½ç©©å®š

  const mount = document.getElementById('mount');
  const fab   = document.getElementById('fab');
  const panel = document.getElementById('panel');
  const toast = document.getElementById('toast');

  function showToast(msg){
    toast.textContent = msg; toast.style.display='block';
    setTimeout(()=>toast.style.display='none',1600);
  }

  function renderExternal(){
    mount.innerHTML = `
      <video autoplay muted loop playsinline preload="auto" poster="${poster}"></video>
      <div class="mask"></div>
      <div id="hint" class="hint">ğŸš€ è¼•è§¸é€²å…¥ NeoX å…ƒå®‡å®™å±•è¦½</div>
    `;
    const v = mount.querySelector('video');
    v.src = videoSrc.replace(/\s/g,'%20');
    // é»ä»»ä½•ä½ç½®â†’æ–°åˆ†é é–‹
    mount.onclick = ()=> window.open(\`${oncyber}?\${bust}\`,'_blank','noopener');
    // æ‰‹æ©Ÿï¼šæç¤º 2.5 ç§’å¾Œè‡ªå‹•æ·¡å‡º
    const h = document.getElementById('hint');
    setTimeout(()=>{ if(h) h.style.opacity='0'; }, 2500);
  }

  function renderEmbed(){
    mount.onclick=null;
    mount.innerHTML = `
      <iframe id="oc" src="${oncyber}?${bust}"
        allow="autoplay; fullscreen; xr-spatial-tracking; gyroscope; accelerometer"
        allowfullscreen referrerpolicy="no-referrer-when-downgrade"></iframe>
      <div class="mask"></div>
    `;
    // 8 ç§’å…§æœª settle â†’ éœé»˜åˆ‡å›å¤–é–‹
    let settled=false;
    const f= document.getElementById('oc');
    f.addEventListener('load',()=>{ settled=true; });
    setTimeout(()=>{
      if(!settled){
        mode='external'; localStorage.setItem(key,mode);
        renderExternal(); showToast('å·²è‡ªå‹•åˆ‡å›å¤–é–‹æ¨¡å¼');
      }
    },8000);
  }

  function render(){
    (mode==='embed' ? renderEmbed : renderExternal)();
  }

  // åˆå§‹æ¸²æŸ“
  render(); localStorage.setItem(key,mode);

  // ===== Tiny panelï¼ˆ3ç§’è‡ªå‹•éš±è—ï¼›é•·æŒ‰ç•«é¢å†æ¬¡å–šå‡ºï¼‰ =====
  setTimeout(()=>fab.classList.add('hide'), 3000);
  let panelOpen=false;
  function togglePanel(){
    panelOpen=!panelOpen; panel.style.display=panelOpen?'block':'none';
  }
  fab.onclick=togglePanel;
  document.addEventListener('click', (e)=>{
    if(panelOpen && !panel.contains(e.target) && e.target!==fab){ togglePanel(); }
  });
  // é•·æŒ‰å–šå‡º
  let pressT=null;
  mount.addEventListener('touchstart', ()=>{ pressT=setTimeout(()=>{ fab.classList.remove('hide'); togglePanel(); },500); });
  ['touchend','touchmove','touchcancel'].forEach(ev=>mount.addEventListener(ev,()=>{ clearTimeout(pressT); }));

  // é¢æ¿å‹•ä½œ
  document.getElementById('openNew').onclick = ()=> window.open(`${oncyber}?${bust}`,'_blank','noopener');
  document.getElementById('toEmbed').onclick = ()=>{
    if(isMobile){ showToast('æ‰‹æ©Ÿä¸å»ºè­° Embed'); return; }
    mode='embed'; localStorage.setItem(key,mode); render(); togglePanel();
  };
  document.getElementById('toExternal').onclick = ()=>{ mode='external'; localStorage.setItem(key,mode); render(); togglePanel(); };

})();
</script>
</body>
</html>