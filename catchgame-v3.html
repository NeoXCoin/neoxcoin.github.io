<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
<title>NeoX Catch the Coins – v3</title>
<style>
  html, body { height:100%; margin:0; background:#000; color:#fff; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"PingFang TC","Noto Sans TC",Arial,sans-serif; overflow:hidden;}
  #wrap { position:relative; height:100%; display:grid; place-items:center; overflow:hidden; }

  /* 背景影片 */
  #bgVid {
    position:absolute;
    inset:0;
    width:100%;
    height:100%;
    object-fit:cover;
    z-index:0;
    filter:brightness(0.8) saturate(1.2);
  }

  canvas {
    position:relative;
    z-index:1;
    display:block;
    width:min(92vw,700px);
    aspect-ratio:9/16;
    height:auto;
    border-radius:16px;
    background:rgba(0,0,0,0.2);
    box-shadow:0 20px 60px rgba(0,0,0,.5), inset 0 0 0 1px rgba(255,255,255,.06);
    touch-action:none;
  }

  .hud { position:absolute; inset:0; display:grid; grid-template-rows:auto 1fr auto; pointer-events:none; z-index:2;}
  .topbar{ display:flex; justify-content:space-between; align-items:center; gap:10px; padding:10px 14px; font-weight:700; }
  .badges{ display:flex; gap:8px; flex-wrap:wrap;}
  .badge{ padding:6px 10px; border-radius:10px; background:rgba(255,255,255,.08); box-shadow:inset 0 0 0 1px rgba(255,255,255,.08);}
  .buttons{ display:flex; gap:8px; }
  button{ pointer-events:auto; border:0; border-radius:10px; padding:8px 12px; font-weight:700; background:#2b7cff; color:#fff; cursor:pointer; box-shadow:0 6px 18px rgba(43,124,255,.35); }
  button.alt{ background:#1f2648; box-shadow: inset 0 0 0 1px rgba(255,255,255,.08); }
  .center{ display:grid; place-items:center; padding:10px;}
  .panel{ pointer-events:auto; min-width:clamp(260px,82%,560px); text-align:center; padding:18px 16px 20px; border-radius:14px; background:rgba(10,12,34,.85); box-shadow:0 20px 60px rgba(0,0,0,.5), inset 0 0 0 1px rgba(255,255,255,.06); backdrop-filter: blur(4px); }
  .panel h1{ margin:8px 0 6px; font-size: clamp(20px,4.8vw,28px);}
  .panel p{ margin:6px 0 14px; color:#b9c1ff; font-size:14px; line-height:1.5;}
  .hidden{ display:none !important; }
  .level-banner{ position:absolute; left:50%; top:60px; transform:translateX(-50%); background:rgba(255,255,255,.08); border-radius:999px; padding:8px 14px; font-weight:800; letter-spacing:.3px; pointer-events:none; }
</style>
</head>
<body>
  <div id="wrap">
    <!-- 🔹 動態背景影片 -->
    <video id="bgVid" playsinline muted autoplay loop preload="metadata">
      <source src="https://neoxcoin.github.io/Galaxy.mp4" type="video/mp4">
    </video>

    <!-- 🔹 遊戲畫布 -->
    <canvas id="game" width="450" height="800" aria-label="NeoX Catch the Coins – v3"></canvas>

    <div class="hud" aria-live="polite">
      <div class="topbar">
        <div class="badges">
          <div class="badge" id="scoreBadge">Score: 0</div>
          <div class="badge" id="levelBadge">Level 1 / 5</div>
        </div>
      </div>
      <div class="level-banner hidden" id="levelBanner">LEVEL 1</div>
    </div>
  </div>

<script>
/* ===== 背景影片播放保險 ===== */
const bgVid = document.getElementById('bgVid');
bgVid?.play().catch(()=>{});
['pointerdown','touchstart','keydown'].forEach(evt=>{
  window.addEventListener(evt,()=>{ bgVid?.play().catch(()=>{}); },{once:true,passive:true});
});

/* ===== 遊戲邏輯簡版（沿用v2核心） ===== */
const canvas=document.getElementById('game');
const ctx=canvas.getContext('2d');
function fitHiDPI(){
  const cssW=canvas.clientWidth,cssH=canvas.clientHeight;
  const dpr=Math.max(1,Math.min(devicePixelRatio||1,2));
  if(canvas.width!==Math.round(cssW*dpr)){canvas.width=Math.round(cssW*dpr);canvas.height=Math.round(cssH*dpr);}
  ctx.setTransform(dpr,0,0,dpr,0,0);
}
fitHiDPI();addEventListener('resize',fitHiDPI);

const tray={x:225,y:750,w:160,h:60,speed:6,vx:0};
const coinImg=new Image();coinImg.src="https://neoxcoin.github.io/neox-emoji-128.png";
const chestImg=new Image();chestImg.src="https://neoxcoin.github.io/neox-chest.png";
let coinReady=false,chestReady=false;coinImg.onload=()=>coinReady=true;chestImg.onload=()=>chestReady=true;
const coins=[];let score=0,level=1,spawnTimer=0;const levelBanner=document.getElementById('levelBanner');const scoreBadge=document.getElementById('scoreBadge');const levelBadge=document.getElementById('levelBadge');

function rand(a,b){return Math.random()*(b-a)+a;}
function clamp(v,a,b){return Math.max(a,Math.min(b,v));}

function spawnCoin(){
  coins.push({x:rand(20,canvas.clientWidth-20),y:-20,r:14,vy:rand(2.4,4.5),spin:rand(0,6.28)});
}
function drawCoin(c){
  ctx.save();ctx.translate(c.x,c.y);ctx.rotate(c.spin);
  if(coinReady){ctx.drawImage(coinImg,-c.r,-c.r,c.r*2,c.r*2);}
  else{ctx.fillStyle="#ffd85a";ctx.beginPath();ctx.arc(0,0,c.r,0,Math.PI*2);ctx.fill();}
  ctx.restore();
}
function drawChest(){
  if(!chestReady)return;
  const {x,y,w,h}=tray;
  ctx.drawImage(chestImg,x-w/2,y-h/2,w,h);
}

function flashLevelBanner(text){
  levelBanner.textContent=text;
  levelBanner.classList.remove('hidden');
  setTimeout(()=>levelBanner.classList.add('hidden'),1000);
}
function refreshHUD(){
  scoreBadge.textContent=`Score: ${score}`;
  levelBadge.textContent=`Level ${level}`;
}

function loop(now){
  requestAnimationFrame(loop);
  fitHiDPI();
  ctx.clearRect(0,0,canvas.clientWidth,canvas.clientHeight);
  for(const c of coins){c.y+=c.vy;c.spin+=0.05;drawCoin(c);}
  for(let i=coins.length-1;i>=0;i--){
    const c=coins[i];
    if(c.y>canvas.clientHeight-80 && Math.abs(c.x-tray.x)<tray.w/2){coins.splice(i,1);score+=10;refreshHUD();}
    else if(c.y>canvas.clientHeight+40){coins.splice(i,1);}
  }
  drawChest();
  spawnTimer-=0.016;
  if(spawnTimer<=0){spawnCoin();spawnTimer=rand(0.5,1.2);}
}
requestAnimationFrame(loop);
</script>
</body>
</html>